<div class="container my-5">
  <h2 class="text-center mb-4">Configurar Sala</h2>

  @if (room(); as room) {
    @if (user) {
      <!-- Room Settings -->
      <div class="card mb-4 p-4 shadow-sm">
        <div class="mb-3">
          <label for="room-name" class="form-label">Nome da Sala</label>

          @if (user.isHost) {
            <input
              name="room-name"
              [(ngModel)]="room.name"
              class="form-control"
              (ngModelChange)="changeName($event)"
            />
          } @else {
            <br />
            <span class="text-muted outline-span"> {{ room.name }}</span>
          }
        </div>

        <div class="mb-3 d-flex align-items-center justify-content-between">
          <div>
            <label for="privacy" class="form-label d-block">Privacidade</label>
            @if (user.isHost) {
              <button
                name="privacy"
                class="btn"
                [ngClass]="{
                  'btn-outline-primary': !room.isPublic,
                  'btn-outline-secondary': room.isPublic,
                }"
                (click)="togglePrivacy()"
              >
                {{ room.isPublic ? 'PÃºblico' : 'Privado' }}
              </button>
            } @else {
              <span class="text-muted outline-span">
                {{ room.isPublic ? 'PÃºblico' : 'Privado' }}</span
              >
            }
          </div>

          @if (!room.isPublic) {
            <div>
              <button class="btn btn-outline-primary" (click)="copyInviteLink()">
                <i class="bi bi-link-45deg"></i> Copiar link de convite
              </button>
            </div>
          }
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="winning-rounds" class="form-label">Rondas para Vencer</label>
            <input
              name="winning-rounds"
              type="number"
              [(ngModel)]="room.winningRounds"
              class="form-control"
              min="1"
              [disabled]="true"
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="max-players" class="form-label">MÃ¡ximo de Jogadores</label>
            <input
              name="max-players"
              type="number"
              [(ngModel)]="room.maxPlayers"
              class="form-control"
              min="3"
              [disabled]="true"
            />
          </div>
        </div>
      </div>

      <!-- Players Section -->
      <div class="card p-4 shadow-sm mb-4">
        <h4 class="mb-3">Jogadores ({{ players.length }}/{{ room.maxPlayers }})</h4>

        <ul class="list-group">
          @for (player of players; track $index) {
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ player.username }}</strong>

                @if (player.isHost) {
                  <span class="text-warning ms-2">ðŸ‘‘ Host</span>
                }
              </div>

              <div>
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-success': player.status === 'READY',
                    'bg-secondary': player.status === 'WAITING',
                  }"
                >
                  {{ player.status === 'READY' ? 'Pronto' : 'Ã€ Espera' }}
                </span>
              </div>
            </li>
          }
        </ul>

        <div class="mt-3 text-center text-muted">{{ readyCount }}/{{ players.length }} prontos</div>
      </div>

      <!-- Action Buttons -->
      <div class="text-center">
        <button
          class="btn btn-lg me-3"
          [ngClass]="{
            'bg-success': user.status === 'READY',
            'btn-primary bg-secondary': user.status === 'WAITING',
          }"
          (click)="toggleStatus()"
          (keydown)="toggleStatus()"
        >
          {{ user.status === 'READY' ? 'Pronto' : 'Ã€ Espera' }}
        </button>

        @if (user.isHost) {
          <button
            class="btn btn-primary btn-lg me-3"
            (click)="startGame()"
            [disabled]="readyCount < players.length"
          >
            Iniciar Jogo
          </button>
        }

        <a routerLink="/" class="btn btn-outline-secondary btn-lg">Voltar</a>
      </div>
    }
  } @else if (errorMessage()) {
    <p class="text-center" style="color: red">{{ errorMessage() }}</p>
    <loading-skeleton></loading-skeleton>
  } @else {
    <p class="text-center text-muted">Loading...</p>
  }
</div>
